<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Event Creation Wizard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Create Event</h1>

    <!-- Optional: Step Indicator -->
    <div class="step-indicator">
        {% if step %} Step {{ step }} of 7 {% endif %}
    </div>

    <!-- STEP 1 -->
    <div class="step" id="step1">
        <h2>Step 1: Event Information</h2>
        <form method="POST" action="{{ url_for('eventcreate', step=2) }}">
            <label>Event Name:</label><br>
            <input type="text" name="event_name" required><br><br>
            <label>Project Code:</label><br>
            <input type="text" name="project_code" required><br><br>
            <div class="nav-buttons">
                <button type="submit">Next</button>
            </div>
        </form>
    </div>

    <!-- STEP 2 -->
    <!-- STEP 2a: Upload Recipient File -->
<div class="step" id="step2">
    {% if step == '2' %}
    <h2>Step 2: Upload Universe File</h2>
    <form method="POST" action="{{ url_for('eventcreate', step=2) }}" enctype="multipart/form-data">
        <label>Upload Recipient CSV:</label><br>
        <input type="file" name="recipient_file" required><br><br>

        <div class="nav-buttons">
            <a href="{{ url_for('eventcreate') }}?step=1">Back</a>
            <button type="submit">Next</button>
        </div>
    </form>
    {% endif %}
</div>

<!-- STEP 2b: Map Columns -->
<div class="step" id="step2b">
    {% if step == '2b' %}
    <h2>Step 2b: Map Columns</h2>
    <form method="POST" action="{{ url_for('eventcreate', step=2b) }}">
        <label>Map Phone Column:</label>
        <select name="phone_column" required>
            {% for col in phone_columns %}
            <option value="{{ col }}">{{ col }}</option>
            {% endfor %}
        </select><br><br>

        <label>Map URL Column:</label>
        <select name="url_column" required>
            {% for col in url_columns %}
            <option value="{{ col }}">{{ col }}</option>
            {% endfor %}
        </select><br><br>

        <label>First Name Column (optional):</label>
        <select name="first_name_column">
            {% for col in first_columns %}
            <option value="{{ col }}">{{ col }}</option>
            {% endfor %}
        </select><br><br>

        <label>Last Name Column (optional):</label>
        <select name="last_name_column">
            {% for col in last_columns %}
            <option value="{{ col }}">{{ col }}</option>
            {% endfor %}
        </select><br><br>

        <div class="nav-buttons">
            <a href="{{ url_for('eventcreate') }}?step=2">Back</a>
            <button type="submit">Next</button>
        </div>
    </form>
    {% endif %}
</div>


    <!-- STEP 3 -->
    <div class="step" id="step3">
        <h2>Step 3: Set Schedule</h2>
        <form method="POST" action="{{ url_for('eventcreate', step=4) }}">
            <label>Event Date:</label>
            <input type="date" name="event_date" required><br><br>

            <label>Event Time:</label>
            <input type="time" name="event_time" required><br><br>

            <label>Timezone:</label>
            <select name="timezone" required>
                <option value="EST">EST</option>
                <option value="CST">CST</option>
                <option value="MST">MST</option>
                <option value="PST">PST</option>
            </select><br><br>

            <div class="nav-buttons">
                <a href="{{ url_for('eventcreate') }}?step=2">Back</a>
                <button type="submit">Next</button>
            </div>
        </form>
    </div>

    <!-- STEP 4 -->
    <div class="step" id="step4">
        <h2>Step 4: Message Content</h2>
        <form method="POST" action="{{ url_for('eventcreate', step=5) }}">
            <label>Message Template:</label><br>
            <textarea name="message_body" rows="5" cols="60" required></textarea><br><br>

            <label>Image Link (optional):</label>
            <input type="text" name="image_url"><br><br>

            <div class="nav-buttons">
                <a href="{{ url_for('eventcreate') }}?step=3">Back</a>
                <button type="submit">Next</button>
            </div>
        </form>
    </div>

    <!-- STEP 5 -->
    <div class="step" id="step5">
        <h2>Step 5: Upload Sender Numbers</h2>
        <form method="POST" action="{{ url_for('eventcreate', step=6) }}" enctype="multipart/form-data">
            <label>Upload From-Numbers File (CSV or TXT):</label><br>
            <input type="file" name="from_file" required><br><br>

            <div class="nav-buttons">
                <a href="{{ url_for('eventcreate') }}?step=4">Back</a>
                <button type="submit">Next</button>
            </div>
        </form>
    </div>

    <!-- STEP 6 -->
    <div class="step" id="step6">
        <h2>Step 6: Approvers</h2>
        <form method="POST" action="{{ url_for('eventcreate', step=7) }}">
            <label>Approver Name:</label><br>
            <input type="text" name="approver_name" required><br><br>
            <label>Approver Phone Number:</label><br>
            <input type="text" name="approver_phone" required><br><br>

            <div class="nav-buttons">
                <a href="{{ url_for('eventcreate') }}?step=5">Back</a>
                <button type="submit">Next</button>
            </div>
        </form>
    </div>

    <!-- STEP 7 -->
    <div class="step" id="step7">
        <h2>Step 7: Final Summary</h2>
        <p>Total recipients uploaded: {{ total }}</p>
        <p>Valid phone numbers: {{ valid }}</p>
        <p>Removed (invalid or opted-out): {{ removed }}</p>
        <p>Scheduled send time: {{ send_time }}</p>

        <form method="POST" action="{{ url_for('eventcreate_commit') }}">
            <button type="submit">Commit for Processing</button>
        </form>

        <div class="nav-buttons">
            <a href="{{ url_for('eventcreate') }}?step=6">Back</a>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const step = urlParams.get('step') || '1';
        const step = new URLSearchParams(window.location.search).get('step') || '1';
        document.getElementById('step' + step.replace(/[^a-zA-Z0-9]/g, '')).classList.add('active');
    </script>
</body>
</html>
